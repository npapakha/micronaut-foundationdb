import io.micronaut.build.internal.foundationdb.DownloadLinuxClientTask
import io.micronaut.build.internal.foundationdb.DownloadMacOsClientTask
import org.gradle.internal.os.OperatingSystem

ext {
    fdbVersion = libs.versions.managed.foundationdb.get()
}

tasks.register('downloadLinuxClient', DownloadLinuxClientTask) {
    group = "build"

    version = fdbVersion
    outputDirectory = layout.buildDirectory.dir("foundationdb-client/$fdbVersion/linux").get()
}

tasks.register('downloadMacOsClient', DownloadMacOsClientTask) {
    onlyIf { OperatingSystem.current().isMacOsX() }
    group = "build"

    version = fdbVersion
    outputDirectory = layout.buildDirectory.dir("foundationdb-client/$fdbVersion/osx").get()
}

tasks.named("jar", Jar) {
    dependsOn("downloadLinuxClient", "downloadMacOsClient")

    from(layout.buildDirectory.dir("foundationdb-client/$fdbVersion")) {
        into("lib")
    }
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}
